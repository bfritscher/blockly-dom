<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="../vendor/font-awesome/css/font-awesome.css">
<style>
html, body {
  margin: 0;
  padding: 0;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  overflow: hidden;
  width: 200px;
  font-size: 0;
  font-family: sans-serif;
}

a {
  text-decoration: none;
  color: inherit;
}

a:hover {
  text-decoration: underline;
}

.content {
  padding: 4px;
  font-size: 12px;
}
</style>
<title>Blockly Bridge</title>
<div class="content">
  <a href="./" target="blockly_bridge" data-window-features="width=640,height=480"><i class="fa fa-puzzle-piece" style="padding-right: 0.5em;"></i>Open Blockly Editor</a>
</div>
<script src="storage.js"></script>
<script src="../vendor/jquery.js"></script>
<script>
function makeStyle() {
  return 'position: absolute; bottom: 0; left: 0; border: none; ' +
         'overflow: hidden; ' +
         'width: ' + $('.content').outerWidth() + 'px; ' +
         'height: ' + $('.content').outerHeight() + 'px;';
}

$(function() {
  setInterval(function() {
    if (JSONStorage.get('reload')) {
      JSONStorage.remove('reload');
      window.parent.postMessage(JSON.stringify({type: 'reload'}), '*');
    }
  }, 100);

  window.addEventListener('message', function(event) {
    if (event.source !== window.parent) return;

    var msg = JSON.parse(event.data);

    if (msg.type == 'init') {
      if (msg.noRemoteReload) {
        $('a[target="blockly_bridge"]').attr('href', './?noRemoteReload=on');
      }
    }
  }, false);

  window.parent.postMessage(JSON.stringify({
    type: 'init',
    script: JSONStorage.get('script'),
    style: makeStyle()
  }), "*");

  $('a[data-window-features]').click(function(e) {
    e.preventDefault();
    window.open(this.href, this.target, $(this).attr('data-window-features'));
  });
});
</script>
